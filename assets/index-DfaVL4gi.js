import{e as t,p as e}from"./vendor-DloOgCCB.js";import{S as s,W as i,V as a}from"./core-8d0Ef0yU.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}(),t.allowRemoteModels=!0,t.allowLocalModels=!1;class r{constructor(){this.model=null,this.isLoading=!1,this.currentResults=[],this.currentTab="search",this.similarityThreshold=.5,this.inputWords=[],this.semanticCategories=new s,this.webgpuEngine=new i,this.visualizationEngine=null,this.embeddingCache=new Map,this.initializeApp()}async initializeApp(){console.log("ðŸš€ Iniciando Embedding Visualizer Modular v2.0"),this.initializeElements(),this.setupEventListeners(),await this.initializeModules(),await this.loadModel()}initializeElements(){this.searchTab=document.getElementById("searchTab"),this.mathTab=document.getElementById("mathTab"),this.searchTabContent=document.getElementById("searchTabContent"),this.mathTabContent=document.getElementById("mathTabContent"),this.wordInput=document.getElementById("wordInput"),this.searchBtn=document.getElementById("searchBtn"),this.btnText=this.searchBtn.querySelector(".btn-text"),this.loadingSpinner=this.searchBtn.querySelector(".loading-spinner"),this.mathExpression=document.getElementById("mathExpression"),this.calculateBtn=document.getElementById("calculateBtn"),this.calcBtnText=this.calculateBtn.querySelector(".calc-btn-text"),this.calcLoadingSpinner=this.calculateBtn.querySelector(".calc-loading-spinner"),this.similarWords=document.getElementById("similarWords"),this.networkGraph=document.getElementById("networkGraph"),this.resultsTitle=document.getElementById("resultsTitle"),this.statusText=document.getElementById("statusText"),this.progressFill=document.getElementById("progressFill")}setupEventListeners(){this.searchTab.addEventListener("click",(()=>this.switchTab("search"))),this.mathTab.addEventListener("click",(()=>this.switchTab("math"))),this.searchBtn.addEventListener("click",(()=>this.performSearch())),this.wordInput.addEventListener("keypress",(t=>{"Enter"===t.key&&this.performSearch()})),document.querySelectorAll(".example-btn").forEach((t=>{t.addEventListener("click",(t=>{this.wordInput.value=t.target.dataset.word,this.performSearch()}))})),this.calculateBtn.addEventListener("click",(()=>this.performCalculation())),this.mathExpression.addEventListener("keypress",(t=>{"Enter"===t.key&&this.performCalculation()})),document.querySelectorAll(".math-example-btn").forEach((t=>{t.addEventListener("click",(t=>{this.mathExpression.value=t.target.dataset.expr,this.performCalculation()}))}))}async initializeModules(){console.log("ðŸ”§ Inicializando mÃ³dulos..."),await this.webgpuEngine.initialize(),this.visualizationEngine=new a(this.networkGraph,this.semanticCategories.getCategoryColors()),console.log("âœ… MÃ³dulos inicializados!"),console.log("ðŸ“Š EstatÃ­sticas:",this.semanticCategories.getStats())}async loadModel(){try{this.updateStatus("Carregando modelo E5-Small...",10),this.model=await e("feature-extraction","Xenova/multilingual-e5-small",{progress_callback:t=>{if("downloading"===t.status){const e=Math.round(t.loaded/t.total*80);this.updateStatus(`Baixando: ${e}%`,e)}else"loading"===t.status&&this.updateStatus("Carregando modelo...",85)}}),this.updateStatus("Testando modelo...",90);const t=await this.getEmbedding("teste");console.log("âœ… Modelo testado:",t.length,"dimensÃµes"),this.updateStatus("Sistema pronto!",100),this.enableInterface(),setTimeout((()=>{document.getElementById("statusBar").style.display="none"}),2e3)}catch(t){console.error("âŒ Erro ao carregar modelo:",t),this.updateStatus("Erro ao carregar modelo. Recarregue a pÃ¡gina.",0)}}async getEmbedding(t){if(!this.model)throw new Error("Modelo nÃ£o carregado");if(this.embeddingCache.has(t))return this.embeddingCache.get(t);try{const e=t.toLowerCase().trim(),s=await this.model(e,{pooling:"mean",normalize:!0}),i=Array.from(s.data||s);if(!i||0===i.length)throw new Error("Embedding vazio");return this.embeddingCache.set(t,i),i}catch(e){throw console.error(`Erro ao processar "${t}":`,e),e}}async computeSimilarities(t,e){try{return await this.webgpuEngine.computeCosineSimilarity(t,e)}catch(s){return console.warn("Fallback para CPU:",s),this.webgpuEngine.computeCosineSimilarityCPU(t,e)}}async performSearch(){const t=this.wordInput.value.trim();if(t&&!this.isLoading&&this.model){this.clearResults(),this.setSearchLoading(!0);try{this.inputWords=[t.toLowerCase()],console.log(`ðŸ” Busca: "${t}"`);const e=this.semanticCategories.getCategoryForWord(t);console.log(`ðŸ“‚ Categoria: ${e.name}`);const s=await this.getEmbedding(t),i=this.semanticCategories.getVocabulary().filter((e=>e.toLowerCase()!==t.toLowerCase())),a=await this.processEmbeddingsBatch(i),r=await this.computeSimilarities(s,a);this.currentResults=this.rankResults(t,i,r),console.log(`âœ… ${this.currentResults.length} resultados encontrados`),this.resultsTitle.textContent=`Busca: "${t}" (${e.name}) - ${this.currentResults.length} resultados`,this.displayResults()}catch(e){console.error("Erro na busca:",e),alert("Erro ao buscar palavras similares.")}finally{this.setSearchLoading(!1)}}}async performCalculation(){const t=this.mathExpression.value.trim();if(t&&!this.isLoading&&this.model){this.clearResults(),this.setCalcLoading(!0);try{const e=this.parseExpression(t);if(!e)return void alert("Formato invÃ¡lido. Use: palavra1 + palavra2 ou palavra1 - palavra2");this.inputWords=e.map((t=>t.word.toLowerCase())),console.log(`ðŸ§® CÃ¡lculo: "${t}"`);let s=await this.getEmbedding(e[0].word);for(let t=1;t<e.length;t++){const i=e[t],a=await this.getEmbedding(i.word);s="+"===i.operation?s.map(((t,e)=>t+a[e])):s.map(((t,e)=>t-a[e]))}const i=Math.sqrt(s.reduce(((t,e)=>t+e*e),0));s=s.map((t=>t/i));const a=this.semanticCategories.getVocabulary().filter((t=>!this.inputWords.includes(t.toLowerCase()))),r=await this.processEmbeddingsBatch(a),n=await this.computeSimilarities(s,r);this.currentResults=this.rankResults(this.inputWords[0],a,n),console.log(`âœ… ${this.currentResults.length} resultados do cÃ¡lculo`),this.resultsTitle.textContent=`CÃ¡lculo: ${t} - ${this.currentResults.length} resultados`,this.displayResults()}catch(e){console.error("Erro no cÃ¡lculo:",e),alert("Erro ao realizar cÃ¡lculo.")}finally{this.setCalcLoading(!1)}}}async processEmbeddingsBatch(t,e=25){const s=[];for(let i=0;i<t.length;i+=e){const a=t.slice(i,i+e),r=await Promise.all(a.map((t=>this.getEmbedding(t))));s.push(...r)}return s}rankResults(t,e,s){return e.map(((e,i)=>{const a=s[i];return{word:e,similarity:this.semanticCategories.calculateAdvancedSimilarity(t,e,a),cosine:a,category:this.semanticCategories.getCategoryForWord(e).name}})).filter((t=>t.similarity>=this.similarityThreshold)).sort(((t,e)=>e.similarity-t.similarity)).slice(0,12)}parseExpression(t){const e=t.replace(/\s+/g," ").split(/\s*([+-])\s*/);if(e.length<3)return null;const s=[{word:e[0].trim(),operation:null}];for(let i=1;i<e.length;i+=2){const t=e[i],a=e[i+1];"+"!==t&&"-"!==t||!a||s.push({word:a.trim(),operation:t})}return s.length>1?s:null}switchTab(t){console.log(`ðŸ”„ Trocando para: ${t}`),this.clearResults(),this.currentTab=t,document.querySelectorAll(".tab-btn").forEach((t=>t.classList.remove("active"))),document.querySelectorAll(".tab-content").forEach((t=>t.classList.remove("active"))),"search"===t?(this.searchTab.classList.add("active"),this.searchTabContent.classList.add("active")):(this.mathTab.classList.add("active"),this.mathTabContent.classList.add("active"))}displayResults(){if(!this.currentResults.length)return;console.log("ðŸŽ¨ displayResults iniciado com",this.currentResults.length,"resultados"),console.log("ðŸ“‹ Renderizando lista..."),this.visualizationEngine.renderResultsList(this.currentResults,this.similarWords,(t=>{"search"===this.currentTab?(this.wordInput.value=t,this.performSearch()):this.mathExpression.value=t})),console.log("âœ… Lista renderizada");const t="search"===this.currentTab?this.wordInput.value||"centro":this.mathExpression.value||"cÃ¡lculo";console.log("ðŸ•¸ï¸ Renderizando grafo para palavra central:",t),console.log("ðŸ“Š Dados para o grafo:",{results:this.currentResults.length,inputWords:this.inputWords,centralWord:t});try{this.visualizationEngine.renderInteractiveGraph(this.currentResults,this.inputWords,t,(t=>{"search"===this.currentTab?(this.wordInput.value=t,this.performSearch()):this.mathExpression.value=t}),(t=>this.getEmbedding(t)),((t,e)=>this.computeSimilarities(t,e)),this.semanticCategories),console.log("âœ… Chamada do grafo concluÃ­da")}catch(e){console.error("âŒ Erro ao renderizar grafo:",e)}}clearResults(){this.currentResults=[],this.inputWords=[],this.similarWords.innerHTML="",this.networkGraph.innerHTML="",this.resultsTitle.textContent="Resultados"}setSearchLoading(t){this.isLoading=t,this.searchBtn.disabled=t,t?(this.btnText.style.display="none",this.loadingSpinner.style.display="inline"):(this.btnText.style.display="inline",this.loadingSpinner.style.display="none")}setCalcLoading(t){this.isLoading=t,this.calculateBtn.disabled=t,t?(this.calcBtnText.style.display="none",this.calcLoadingSpinner.style.display="inline"):(this.calcBtnText.style.display="inline",this.calcLoadingSpinner.style.display="none")}updateStatus(t,e){this.statusText.textContent=t,this.progressFill.style.width=`${e}%`}enableInterface(){this.searchBtn.disabled=!1,this.calculateBtn.disabled=!1,this.wordInput.disabled=!1,this.mathExpression.disabled=!1}dispose(){this.webgpuEngine.dispose(),this.visualizationEngine.dispose(),this.embeddingCache.clear(),console.log("ðŸ§¹ AplicaÃ§Ã£o finalizada")}}document.addEventListener("DOMContentLoaded",(()=>{window.embeddingVisualizer=new r}));
//# sourceMappingURL=index-DfaVL4gi.js.map
